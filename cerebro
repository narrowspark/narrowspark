#!/usr/bin/env php
<?php

use Viserio\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Output\ConsoleOutput;

/*
|--------------------------------------------------------------------------
| Register The Auto Loader
|--------------------------------------------------------------------------
|
| Composer provides a convenient, automatically generated class loader
| for our application. We just need to utilize it! We'll require it
| into the script here so that we do not have to worry about the
| loading of any our classes "manually". Feels great to relax.
|
*/

require __DIR__.'/bootstrap/autoload.php';

/*
|--------------------------------------------------------------------------
| Turn On The Lights
|--------------------------------------------------------------------------
|
| We need to illuminate PHP development, so let's turn on the lights.
| This bootstraps the framework and gets it ready for and then it
| will load up this application so that we can run it and send
| the responses back to the browser and delight these users.
|
*/

$app = require_once __DIR__.'/bootstrap/start.php';

/*
|--------------------------------------------------------------------------
| Load The Cerebro Console Application
|--------------------------------------------------------------------------
|
| We'll need to run the script to load and return the Cerebro console
| application. We keep this in its own script so that we will load
| the console application independent of running commands which
| will allow us to fire commands from Routes when we want to.
|
*/

$app->runningInConsole();

$cerebro = new Application($app, $app->get('events'));
$cerebro->setName('cerebro');
$cerebro->setVersion($app->getVersion());

try {
    return $cerebro->run(new ArgvInput, new ConsoleOutput);
} catch (\Exception $exception) {
    $app->get('exception')->handleConsole($exception);
    return 1;
}

exit($cerebro);
